// vselect 1.01
(function(j,l,p){function q(a){return"undefined"==typeof a}function m(a){return"function"==typeof a}var x=!!p.ActiveXObject&&!p.XMLHttpRequest,k={multipleJointer:"|^|",speed:"fast",shadow:!1},h={select:"vselect",linkOn:"vselect-link-on",panel:"vselect-panel",shadow:"vselect-shadow",tab:"vselect-panel-tab",tabOn:"vselect-panel-tab-on",tabHover:"vselect-panel-tab-hover"},v={selectedValue:null,grouplessLabel:"\u5176\u4ed6",direction:"center",styleString:null,width:null,maxHeight:320,maxColumn:5,maxTop:0},
s=1,t=null,r=[],w=!1,e={init:function(a){w||(w=!0,j(p).resize(function(){if(!(1>r.length)){var a,b,g;for(a=0;a<r.length;a++)b=r[a],g=b._panel,b=e.panelPosition(b,g,e.options(b)),g.css({left:b.x,top:b.y})}}),j(l).click(function(a){a=j(a.srcElement?a.srcElement:a.target);var b;!a.hasClass(h.panel)&&(!a.hasClass(h.select)&&!a.hasClass(h.tab))&&(a=a.parent(),!a.hasClass(h.select)&&!a.hasClass(h.tab)&&(a=a.parent().parent(),(!a.hasClass(h.panel)||!(b=l.getElementById(a.attr("id").slice(0,-5)))||!b||!("undefined"!=
typeof b._multiple&&b._multiple))&&e.hideAll()))}).keyup(function(a){a||(a=p.event);27==(a.keyCode?a.keyCode:a.which)&&e.hideAll()}),j("body:first").append('<div class="'+h.shadow+'" id="__'+h.select+'_shadow" style="display:none">&nbsp;</div>'),t=j("#__"+h.select+"_shadow"));a=a||{};for(var b in v)"undefined"==typeof a[b]&&(a[b]=v[b]);return this.each(function(){e.selectInit.call(this,a)})},selectInit:function(a){var b,c,d,g;if(this.name||this.id)g=j(this).val(),d=0<j(this).find("optgroup").length,
c=e._createDom(this,a,d),b=c[0],b._options=a,b._panel=j("#__"+h.select+(s-1)+"panel"),b._value=c.find("input:first"),b._caption=c.find("em:first"),0<a.width&&c.css("width",a.width),b._selectWidth=c.width(),b._group=d,b._multiple=this.multiple,b._initSelectedIndex=this.options.selectedIndex,b._origMaxHeight=a.maxHeight,d?(b._tab=b._panel.find("div."+h.tab+":first"),e.panelInitWithOptgroup(b,b._panel,a),e.panelArrangeWithOptgroup(b,b._panel,a)):(e.panelInit(b,b._panel,a),e.panelArrange(b,b._panel,a)),
c.click(e.selectClick),j(this).remove(),e.setValue.call(b,null===a.selectedValue?g:a.selectedValue)},panelInit:function(a,b){var c,d=j(b).find("a");for(c=0;c<d.length;c++)q(d[c].rel)||(d[c].onclick=function(b){e.itemClick.call(a,b,this.getAttribute("rel"))})},panelArrange:function(a,b,c){var d=e.borderSize(b),d=j(a).outerWidth()-d.width,g=1;b.find("ul").hide().eq(0).css("display","block");for(b.css({width:d,height:"auto"}).find("li").css("width",d);(a._panelHeight=b.height())>c.maxHeight;)if(++g<=
c.maxColumn)b.css("width",d*g);else{c.maxHeight=b.height();break}},panelInitWithOptgroup:function(a,b,c){b.find("div."+h.tab+" em").hover(function(){j(this).addClass(h.tabHover)},function(){j(this).removeClass(h.tabHover)}).each(function(b){this.onclick=function(){e.panelTabClick(a,b)}});b.find("> ul").each(function(){e.panelInit(a,this,c)})},panelArrangeWithOptgroup:function(a,b,c){var d=e.borderSize(b),g=j(a).outerWidth()-d.width,f=b.find("> ul");1>f.length||(a._panelWidth=0,a._panelHeight=0,a._panelTabWidth=
0,a._panelTabHeight=0,gridHeight=b.find("li:first").height(),f.each(function(){var d=j(this),e=1;f.hide();d.css("display","block");b.css({width:g,height:"auto"});for(d.find("li").css("width",g);b.height()>c.maxHeight;)if(++e<=c.maxColumn)b.css("width",g*e);else break;a._panelWidth=Math.max(b.width(),a._panelWidth)}),f.each(function(){var d=j(this),e=1;f.hide();d.css("display","block");b.css({width:a._panelWidth,height:"auto"});for(d.find("li").css("width",g);b.height()>c.maxHeight;)if(++e<=c.maxColumn)b.css("width",
g*e);else{c.maxHeight=b.height();break}a._panelHeight=Math.max(b.height(),a._panelHeight)}),e.panelActiveSelectedTab(a))},_createDom:function(a,b,c){var d="",g,f="",k;if(c){g=j(a).find("optgroup");for(c=0;c<g.size();c++)f+="<em>"+(g[c].label||index)+"</em>",d+=e._createBlock(g[c]);0<j(a).find("> option").size()&&(f+="<em>"+b.grouplessLabel+"</em>",d+=e._createBlock(a));f='<div class="'+h.tab+'">'+f+"</div>"}else d=e._createBlock(a);c=a.id?' id="'+a.id+'" ':"";g=a.name?' name="'+a.name+'" ':"";k=a.getAttribute("title")?
' title="'+a.getAttribute("title")+'" ':"";b=b.styleString?' style="'+b.styleString+'" ':"";j(a).after('<a href="javascript:;" class="'+h.select+'" id="__'+h.select+s+'"'+k+b+'><input type="hidden" '+c+g+' value="" /><em></em><i>&#9660;</i></a>');j("body:first").append('<div class="'+h.panel+'" id="__'+h.select+s+'panel" style="display:none">'+f+d+"</div>");return j(l.getElementById("__"+h.select+s++))},_createBlock:function(a){var b="";a=j(a).find("> option");var c;for(c=0;c<a.length;c++)q(a[c].text)&&
(a[c].text=a[c].value),b+='<li><a href="javascript:;" rel="'+a[c].value+'">'+a[c].text+"</a></li>";return"<ul>"+b+"</ul>"},setValue:function(a){var b,c,d=null,g=j(this);e.options(this);var f=this._panel.find("a");if(this._multiple){var l=[],u=[];for(b=0;b<f.length;b++)c=f[b],!q(c.rel)&&c.rel==a&&(c.className=c.className==h.linkOn?"":h.linkOn),c.className==h.linkOn&&(l.push(c.innerHTML),u.push(c.rel));a=d="";0<u.length&&(d=l.join(","),a=u.join(k.multipleJointer))}else{f.removeClass(h.linkOn);for(b=
0;b<f.length;b++)c=f[b],!q(c.rel)&&c.rel==a&&(c.className=h.linkOn,d=c.innerHTML);null===d&&0<f.length&&(a=f[0].rel,d=f[0].innerHTML)}this._caption.html(d);this._value.val(a).attr("rel",d);this._caption.width()+26>this._selectWidth&&g.width(this._caption.width()+26);this._caption.width()+26<this._selectWidth&&g.width(this._selectWidth);if(this._group){var n={};this._tab.find("em").css("text-decoration","none");this._panel.find("a."+h.linkOn).each(function(){n[j(this).parent().parent().index()-1]=
1});for(b in n)this._tab.find("em:eq("+b+")").css("text-decoration","underline")}},selectClick:function(a){e.haltEvent(a);e.hideAll();e.show.call(this)},itemClick:function(a,b){var c=e.options(this),d=b!=this._value.val();this._multiple||e.hideAll();e.setValue.call(this,b);if(m(c.click)||d&&m(c.change))e.haltEvent(a),m(c.click)&&c.click.call(this._value,a,b),d&&m(c.change)&&c.change.call(this._value,a,b)},clickValue:function(a){this._panel.find("a[rel='"+a+"']").trigger("click");this._tab&&e.panelActiveSelectedTab(this)},
panelTabClick:function(a,b){a._panel.find("div."+h.tab).find("em").removeClass(h.tabOn).eq(b).addClass(h.tabOn);a._panel.find("> ul").hide().eq(b).show();a._panel.css({width:a._panelWidth,height:a._panelHeight})},panelActiveSelectedTab:function(a){var b,c=a._panel.find("> ul");for(b=0;b<c.length&&!(0<c.eq(b).find("a."+h.linkOn).length);b++);b>=c.length&&(b=0);c.hide().eq(b).show();a._tab.find("em").removeClass(h.tabOn).eq(b).addClass(h.tabOn)},panelPosition:function(a,b,c,d){var g=0,f=0,h=0,k=0;self.innerHeight?
(k=self.innerHeight,h=self.innerWidth,g=self.pageXOffset,f=self.pageYOffset):x?(k=l.documentElement.clientHeight,h=l.documentElement.clientWidth,f=l.documentElement.scrollTop,g=l.documentElement.scrollLeft):l.body&&(k=l.body.clientHeight,h=l.body.clientWidth,g=l.body.scrollLeft,f=l.body.scrollTop);var n=j(a);c=e.options(a);var m,p;m=e.borderSize(b);p=a._group?a._panelWidth:b.width();a=Math.min(a._panelHeight,c.maxHeight);b=d?b.offset().left:n.offset().left;switch(c.direction){case "top":d=n.offset().top+
n.outerHeight()-a-m.height;break;case "bottom":d=n.offset().top;break;default:d=n.offset().top+(n.outerHeight()>>1)-(a>>1)-(m.height>>1)}d<f+c.maxTop&&(d=n.offset().top);d+a>f+k&&(d=n.offset().top+n.outerHeight()-a-m.height);d+a>f+k&&(d=f+k-a-m.height);b+p>g+h&&(b=g+h-p-m.width);0>b&&(b=0);0>d&&(d=c.maxTop);return{x:b,y:d,w:p,h:a}},show:function(){var a=this,b=j(a),c=e.options(a),d,g=a._panel,f;b.blur();g.is(":visible")||(d=e.borderSize(g),g.show().css({height:b.outerHeight()-d.height,left:b.offset().left,
top:b.offset().top}),a._group&&g.css("width",a._panelWidth),f=e.panelPosition(a,g,c,!0),a._panel.animate({height:f.h,left:f.x,top:f.y},k.speed,function(){m(c.show)&&c.show.call(a)}),k.shadow&&t.show().css({width:g.width(),height:b.outerHeight()-d.height,left:b.offset().left,top:b.offset().top}).animate({height:f.h,left:f.x+6,top:f.y+6},k.speed),r.push(a))},hide:function(){var a=this,b=e.options(a),c=j(this),d=this._panel,g=e.borderSize(d),f;f=d.css("z-index");d.css("z-index",f-1);d.animate({height:c.outerHeight()-
g.height,left:c.offset().left,top:c.offset().top},k.speed,function(){d.hide();d.css("z-index",f);m(b.hide)&&b.hide.call(a)});k.shadow&&t.hide()},hideAll:function(){for(var a;a=r.pop();)e.hide.call(a)},reset:function(a,b){var c=this._panel,d=e.options(this),g="",f;this._initSelectedIndex=-1;d.maxHeight=this._origMaxHeight;q(b)||(d.selectedValue=b);for(f in a)g+='<li><a href="javascript:;" rel="'+f+'">'+a[f]+"</a></li>";c.empty().html("<ul>"+g+"</ul>");e.panelInit(this,c,d);e.panelArrange(this,c,d);
e.setValue.call(this,d.selectedValue)},haltEvent:function(a){a=a||p.event;a.stopPropagation?a.stopPropagation():a.cancelBubble=!0;return!1},borderSize:function(a){a=j(a);return{width:parseInt(a.css("border-left-width"))+parseInt(a.css("border-right-width")),height:parseInt(a.css("border-top-width"))+parseInt(a.css("border-bottom-width"))}},options:function(a){return a._options?a._options:{}},value:function(){return this._value?this._value.val():this.value},caption:function(){return this._value?this._value[0].getAttribute("rel"):
this.getAttribute("rel")}};j.vselect={config:function(a){return"undefined"==typeof k[a]?void 0:k[a]},setConfig:function(a,b){switch(typeof a){case "object":for(var c in a)k[c]=a[c];return;case "array":for(c=0;c<a.length;c++)k[c]=a[c];return}k[a]=b},style:function(a){return"undefined"==typeof h[a]?void 0:h[a]},setStyle:function(a,b){switch(typeof a){case "object":for(var c in a)h[c]=a[c];return;case "array":for(c=0;c<a.length;c++)h[c]=a[c];return}h[a]=b},hide:e.hideAll};j.fn.extend({vselect:function(){return e.init.apply(this,
arguments)},vselectShow:function(){var a=arguments;return this.each(function(){e.show.apply(this._panel?this:j(this).parent()[0],a)})},vselectHide:function(){var a=arguments;return this.each(function(){e.hide.apply(this._panel?this:j(this).parent()[0],a)})},vselectValue:function(){return 1>this.size()?null:e.value.apply(this[0])},vselectSetValue:function(a){return 1>this.size()?null:e.setValue.call(this.parent()[0],a)},vselectClickValue:function(a){return 1>this.size()?null:e.clickValue.call(this.parent()[0],
a)},vselectCaption:function(){return 1>this.size()?null:e.caption.call(this[0])},vselectReset:function(){var a=arguments;return this.each(function(){e.reset.apply(this._panel?this:j(this).parent()[0],a)})}})})(jQuery,document,window);
