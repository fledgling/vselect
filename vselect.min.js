(function(j,p,r){function u(a){return"undefined"==typeof a}function s(a){return"function"==typeof a}var z=!!r.ActiveXObject&&!r.XMLHttpRequest,k={speed:"fast",shadow:!1},h={select:"vselect",linkOn:"vselect-link-on",panel:"vselect-panel",shadow:"vselect-shadow",tab:"vselect-panel-tab",tabOn:"vselect-panel-tab-on",tabHover:"vselect-panel-tab-hover"},x={defaultValue:null,defaultCaption:null,grouplessLabel:"\u5176\u4ed6",direction:"center",styleString:null,width:null,maxHeight:320,maxColumn:5,maxTop:0},
v=1,w=null,t=[],y=!1,e={init:function(a){y||(y=!0,j(r).resize(function(){if(!(1>t.length)){var a,b,f;for(a=0;a<t.length;a++)b=t[a],f=b._panel,b=e.panelPosition(b,f,e.options(b)),f.css({left:b.x,top:b.y})}}),j(p).click(function(a){a=j(a.srcElement?a.srcElement:a.target);var b;if(!a.hasClass(h.panel)&&(!a.hasClass(h.select)&&!a.hasClass(h.tab))&&(a=a.parent(),!a.hasClass(h.select)&&!a.hasClass(h.tab))){a=a.parent().parent();if(a.hasClass(h.panel)&&(b=a.attr("id")))if((b=j("a[rel='"+b+"']:first")[0])&&
"undefined"!=typeof b._multiple&&b._multiple)return;e.panelClean()}}).keyup(function(a){a||(a=r.event);27==(a.keyCode?a.keyCode:a.which)&&e.panelClean()}),j("body:first").append('<div class="'+h.shadow+'" id="__'+h.select+'_shadow" style="display:none">&nbsp;</div>'),w=j("#__"+h.select+"_shadow"));a=a||{};for(var b in x)"undefined"==typeof a[b]&&(a[b]=x[b]);return this.each(function(){u(this.nodeName)||(b=this.nodeName.toLowerCase()+"Init",s(e[b])&&e[b].call(this,a))})},_createBlock:function(a){var b=
"";a=j(a).find("> option");var c;for(c=0;c<a.length;c++)u(a[c].text)&&(a[c].text=a[c].value),b+='<li><a href="javascript:;" rel="'+a[c].value+'">'+a[c].text+"</a></li>";return"<ul>"+b+"</ul>"},_createHtml:function(a,b,c,d){var f,g=v,l;v++;f=e._createBlock(c);a=a?' id="'+a+'" ':"";b=b?' name="'+b+'" ':"";l=c.getAttribute("title")?' title="'+c.getAttribute("title")+'" ':"";d=d.styleString?' style="'+d.styleString+'" ':"";j(c).after('<a href="javascript:;" class="'+h.select+'" rel="__'+h.select+g+'"'+
l+d+'><input type="hidden" '+a+b+' value="" /><em></em><i>&#9660;</i></a>');j("body:first").append('<div class="'+h.panel+'" id="__'+h.select+g+'" style="display:none">'+f+"</div>");return g},_createHtmlWithOptgroup:function(a,b,c,d){var f="",g,l="",q=0,m=v,n;v++;n=j(c).find("optgroup");for(g=0;g<n.size();g++)q++,l+="<em>"+(n[g].label||q)+"</em>",f+=e._createBlock(n[g]);0<j(c).find("> option").size()&&(l+="<em>"+d.grouplessLabel+"</em>",f+=e._createBlock(c));a=a?' id="'+a+'" ':"";b=b?' name="'+b+
'" ':"";g=c.getAttribute("title")?' title="'+c.getAttribute("title")+'" ':"";d=d.styleString?' style="'+d.styleString+'" ':"";j(c).after('<a href="javascript:;" class="'+h.select+'" rel="__'+h.select+m+'"'+g+d+'><input type="hidden" '+a+b+' value="" /><em></em><i>&#9660;</i></a>');j("body:first").append('<div class="'+h.panel+'" id="__'+h.select+m+'" style="display:none"><div class="'+h.tab+'">'+l+"</div>"+f+"</div>");return m},selectInit:function(a){var b=this,c=j(b),d;d=b.id;var f=b.name,g;if(f||
d)1>j(b).find("optgroup").size()?(g=e._createHtml(d,f,b,a),f=!1):(g=e._createHtmlWithOptgroup(d,f,b,a),f=!0),d=c.next(),b=d[0],b._options=a,b._panel=j("#__"+h.select+g),b._value=d.find("input:first"),b._caption=d.find("em:first"),0<a.width&&d.css("width",a.width),b._selectWidth=d.width(),b._group=f,b._multiple=this.multiple,b._initSelectedIndex=this.options.selectedIndex,b._origMaxHeight=a.maxHeight,f?(b._tab=b._panel.find("div."+h.tab+":first"),e.panelInitWithOptgroup(b,b._panel,a),e.panelArrangeWithOptgroup(b,
b._panel,a)):(e.panelInit(b,b._panel,a),e.panelArrange(b,b._panel,a)),d.click(e.selectClick),s(a.change)&&b._value.change(a.change),c.remove()},_panelBlockInit:function(a,b){var c,d=j(b).find("a");for(c=0;c<d.length;c++)u(d[c].rel)||(d[c].onclick=function(b){e.itemClick.call(a,b,this.rel,this.innerHTML)})},_panelValueInit:function(a,b,c){var d="",f="";-1<a._initSelectedIndex&&(b=b.find("a:eq("+a._initSelectedIndex+")"),d=b.attr("rel"),f=b.text());null!==c.defaultValue&&(d=c.defaultValue,f=null===
c.defaultCaption?d:c.defaultCaption);e.selectSetValue.call(a,d,f,c)},panelInit:function(a,b,c){e._panelBlockInit(a,b);e._panelValueInit(a,b,c)},panelArrange:function(a,b,c){var d=e.borderSize(b),d=j(a).outerWidth()-d.width,f=1;b.find("ul").hide().eq(0).css("display","block");for(b.css({width:d,height:"auto"}).find("li").css("width",d);(a._panelHeight=b.height())>c.maxHeight;)if(++f<=c.maxColumn)b.css("width",d*f);else{c.maxHeight=b.height();break}},panelInitWithOptgroup:function(a,b,c){b.find("div."+
h.tab+" em").hover(function(){j(this).addClass(h.tabHover)},function(){j(this).removeClass(h.tabHover)}).each(function(b){this.onclick=function(){e.panelTabClick(a,b)}});b.find("> ul").each(function(){e._panelBlockInit(a,this)});e._panelValueInit(a,b,c)},panelArrangeWithOptgroup:function(a,b,c){var d=e.borderSize(b),f=j(a).outerWidth()-d.width,g=b.find("> ul");1>g.length||(a._panelWidth=0,a._panelHeight=0,a._panelTabWidth=0,a._panelTabHeight=0,gridHeight=b.find("li:first").height(),g.each(function(){var d=
j(this),e=1;g.hide();d.css("display","block");b.css({width:f,height:"auto"});for(d.find("li").css("width",f);b.height()>c.maxHeight;)if(++e<=c.maxColumn)b.css("width",f*e);else break;a._panelWidth=Math.max(b.width(),a._panelWidth)}),g.each(function(){var d=j(this),e=1;g.hide();d.css("display","block");b.css({width:a._panelWidth,height:"auto"});for(d.find("li").css("width",f);b.height()>c.maxHeight;)if(++e<=c.maxColumn)b.css("width",f*e);else{c.maxHeight=b.height();break}a._panelHeight=Math.max(b.height(),
a._panelHeight)}),e.panelActiveSelectedTab(a))},panelActiveSelectedTab:function(a){var b,c=a._panel.find("> ul");for(b=0;b<c.length&&!(0<c.eq(b).find("a."+h.linkOn).length);b++);b>=c.length&&(b=0);c.hide().eq(b).show();a._tab.find("em").removeClass(h.tabOn).eq(b).addClass(h.tabOn)},panelTabClick:function(a,b){a._panel.find("div."+h.tab).find("em").removeClass(h.tabOn).eq(b).addClass(h.tabOn);a._panel.find("> ul").hide().eq(b).show();a._panel.css({width:a._panelWidth,height:a._panelHeight})},panelPosition:function(a,
b,c,d){var f=0,g=0,h=0,q=0;self.innerHeight?(q=self.innerHeight,h=self.innerWidth,f=self.pageXOffset,g=self.pageYOffset):z?(q=p.documentElement.clientHeight,h=p.documentElement.clientWidth,g=p.documentElement.scrollTop,f=p.documentElement.scrollLeft):p.body&&(q=p.body.clientHeight,h=p.body.clientWidth,f=p.body.scrollLeft,g=p.body.scrollTop);var m=j(a);c=e.options(a);var n,k;n=e.borderSize(b);k=a._group?a._panelWidth:b.width();a=Math.min(a._panelHeight,c.maxHeight);b=d?b.offset().left:m.offset().left;
switch(c.direction){case "top":d=m.offset().top+m.outerHeight()-a-n.height;break;case "bottom":d=m.offset().top;break;default:d=m.offset().top+(m.outerHeight()>>1)-(a>>1)-(n.height>>1)}d<g+c.maxTop&&(d=m.offset().top);d+a>g+q&&(d=m.offset().top+m.outerHeight()-a-n.height);d+a>g+q&&(d=g+q-a-n.height);b+k>f+h&&(b=f+h-k-n.width);0>b&&(b=0);0>d&&(d=c.maxTop);return{x:b,y:d,w:k,h:a}},selectClick:function(a){var b=this,c=j(b),d=e.options(b),f=b._panel,g;a=a||r.event;a.stopPropagation?a.stopPropagation():
a.cancelBubble=!0;e.panelClean();c.blur();f.is(":visible")||(a=e.borderSize(f),f.show().css({height:c.outerHeight()-a.height,left:c.offset().left,top:c.offset().top}),b._group&&f.css("width",b._panelWidth),g=e.panelPosition(b,f,d,!0),b._panel.animate({height:g.h,left:g.x,top:g.y},k.speed,function(){s(d.show)&&d.show.call(b)}),k.shadow&&w.show().css({width:f.width(),height:c.outerHeight()-a.height,left:c.offset().left,top:c.offset().top}).animate({height:g.h,left:g.x+6,top:g.y+6},k.speed),t.push(b))},
itemClick:function(a,b,c){a=e.options(this);this._multiple||e.panelClean();e.selectSetValue.call(this,b,c,a);this._value.trigger("change")},reset:function(a,b){var c=this._panel,d=e.options(this),f="",g;this._initSelectedIndex=0;d.maxHeight=this._origMaxHeight;for(g in a)b==g&&(this._initSelectedIndex=i++),f+='<li><a href="javascript:;" rel="'+g+'">'+a[g]+"</a></li>";c.empty().html("<ul>"+f+"</ul>");e.panelInit(this,c,d);e.panelArrange(this,c,d)},panelHide:function(){var a=this,b=e.options(a),c=j(this),
d=this._panel,f=e.borderSize(d),g;g=d.css("z-index");d.css("z-index",g-1);d.animate({height:c.outerHeight()-f.height,left:c.offset().left,top:c.offset().top},k.speed,function(){d.hide();d.css("z-index",g);s(b.hide)&&b.hide.call(a)});k.shadow&&w.hide()},panelClean:function(){for(var a;a=t.pop();)e.panelHide.apply(a)},selectSetValue:function(a,b,c){var d=j(this);c=e.options(this);if(this._multiple){b=[];var f=[],g,l,k=this._panel.find("a");for(g=0;g<k.length;g++)l=k[g],!u(l.rel)&&l.rel==a&&(l.className=
-1<l.className.indexOf(h.linkOn)?"":h.linkOn),-1<l.className.indexOf(h.linkOn)&&(b.push(l.innerHTML),f.push(l.rel));0<f.length||null===c.defaultValue?(b=b.join(","),a=f.join("|^|")):(a=c.defaultValue,b=c.defaultCaption||c.defaultValue)}else this._panel.find("a").removeClass(h.linkOn),this._panel.find("a[rel='"+a+"']").addClass(h.linkOn);this._caption.html(b);this._value.val(a).attr("rel",b);this._caption.width()+26>this._selectWidth&&d.width(this._caption.width()+26);this._caption.width()+26<this._selectWidth&&
d.width(this._selectWidth);if(this._group){var m={};this._tab.find("em").css("text-decoration","none");this._panel.find("a."+h.linkOn).each(function(){m[j(this).parent().parent().index()-1]=1});for(g in m)this._tab.find("em:eq("+g+")").css("text-decoration","underline")}},_castByType:function(a){"string"==typeof this.nodeName&&(a=this.nodeName.toLowerCase()+a,s(e[a])&&e[a].call(this))},showItem:function(){this.each(function(){e._castByType.call(this,"Show")})},hideItem:function(){this.each(function(){e._castByType.call(this,
"Hide")})},borderSize:function(a){a=j(a);return{width:parseInt(a.css("border-left-width"))+parseInt(a.css("border-right-width")),height:parseInt(a.css("border-top-width"))+parseInt(a.css("border-bottom-width"))}},options:function(a){return a._options?a._options:{}},value:function(){return this._value?this._value.val():this.value},setValue:function(a){this._panel.find("a[rel='"+a+"']").trigger("click");this._tab&&e.panelActiveSelectedTab(this)},caption:function(){return this._value?this._value[0].getAttribute("rel"):
this.getAttribute("rel")}};j.vselect={config:function(a){return"undefined"==typeof k[a]?void 0:k[a]},setConfig:function(a,b){switch(typeof a){case "object":for(var c in a)k[c]=a[c];return;case "array":for(c=0;c<a.length;c++)k[c]=a[c];return}k[a]=b},style:function(a){return"undefined"==typeof h[a]?void 0:h[a]},setStyle:function(a,b){switch(typeof a){case "object":for(var c in a)h[c]=a[c];return;case "array":for(c=0;c<a.length;c++)h[c]=a[c];return}h[a]=b},hide:e.panelClean};j.fn.extend({vselect:function(){e.init.apply(this,
arguments)},vselectShow:function(){e.showItem.apply(this,arguments)},vselectHide:function(){e.hideItem.apply(this,arguments)},vselectValue:function(){return 1>this.size()?null:e.value.apply(this[0])},vselectSetValue:function(a){return 1>this.size()?null:e.setValue.call(this.parent()[0],a)},vselectCaption:function(){return 1>this.size()?null:e.caption.call(this[0])},vselectReset:function(){var a=arguments;return this.each(function(){j(this).is("input:hidden")?e.reset.apply(j(this).parent()[0],a):this._panel&&
e.reset.apply(this,a)})}})})(jQuery,document,window);